<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <title>Sentiment Analysis</title> -->
    <!-- <style>
        .container {
            background-color: rgb(78, 138, 233); /* Set the background color to light green */
            /*background-image: url("C://Users//amitk//OneDrive//Desktop//Project 4 files//static//stock market photo.jpg");  /* Remove the background image */
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            opacity: 0.8;
        }
        /* Add any additional CSS styles directly here if needed */
        h1 {
            color: white (255, 255, 255);
            text-align: center;
            padding: 50px;
        }
        p {
            color: white;
            text-align: center;
            padding: 20px;
        }
        /* Add other styles as needed */
    </style> -->
    <script>
    function fetchOverallAverageScore(ticker) {
        fetch(`http://127.0.0.1:5000/api/v1.0/parse_and_score_news`)
            .then(response => response.json())
            .then(data => {
                const tickerData = data.find(item => item.ticker === ticker);
                if (tickerData) {
                    const overallAverageScore = tickerData.sentiment_score;
                    // Update the HTML with the overall average score
                    document.querySelector('.container p').textContent = `Overall Average Sentiment Score: ${overallAverageScore}`;
                } else {
                    document.querySelector('.container p').textContent = 'Ticker not found or sentiment data unavailable for this ticker.';
                }
            })
            .catch(error => console.error('Error fetching overall average score:', error));
    }

    function refreshPage() {
        var tickerValue = document.getElementById("ticker_input").value;
        if (['HLT', 'MAR', 'CCL', 'WMT', 'WH', 'AMZN', 'UAL', 'DAL', 'CAKE', 'RUTH', 'RCL'].includes(tickerValue)) {
            location.reload();
        } else {
            // Fetch overall average score for the selected ticker
            fetchOverallAverageScore(tickerValue);
        }
    }
  </script>
</head>
<body>
    <div class="container">
        <h1>Enter a ticker symbol (e.g., AMZN) to get the sentiment scores:</h1>
        <form method="POST" id="ticker_form">
            <label for="ticker">Enter Ticker: </label>
            <input type="text" id="ticker" name="ticker" required>
            <button type="submit">Submit</button>
        </form>        
        {% if error %}
    <p style="color: red;">{{ error }}</p>
    {% endif %}

    <!-- <form method="POST" action="/">
        <label for="ticker">Select a Ticker:</label>
        <select id="ticker" name="ticker">
            {% for ticker in tickers %}
            <option value="{{ ticker }}">{{ ticker }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Submit"> -->
    </form>

    {% if submitted %}
    <h2>Selected Ticker: {{ ticker }}</h2>
    <p>Overall Average Sentiment Score: {{ overall_average_score }}</p>
    
    <!-- Conditionally include Plotly JavaScript CDN links when the form is submitted and plot needs to be displayed -->
    {% if plot_html %}
    <!-- Add Plotly JavaScript CDN links -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.8.0.min.js"></script>
    <!-- Add the plot HTML here -->
    {{ plot_html|safe }}
    {% endif %}
    
    {% endif %}
        <div class="overall-score">
            <!-- The overall sentiment score will be displayed here -->
        </div>
    </div>
</body>
</html>
